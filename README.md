# 掘金仿真服务使用手册

https://sim.myquant.cn

## 产品与服务

-------
掘金仿真交易是为量化投资者打造的一个最接近真实市场环境的仿真平台，旨在以坚实的IT技术，助力化量化投研与投资。
本服务主要面向量化投研机构和个人服务，提供整套证券仿真交易的信息化技术平台

投资者可通过掘金官网注册（ https://www.myquant.cn ）后使用。
本服务适用于量化策略开发的检验、测试、优选，提高投资策略实战技能；也提供独立部署，用于证券投研、培训、教育及投资大赛

## 产品特点

- 针对量化策略交易设计，支持界面交易、监控、交易接口
- 支持沪深两市股票、基金交易
- 支持四大期货市场、能源期货所有品种
- 极速行情tick五档撮合+当日基本面结算
- 支持券商投资教育和业务培训一体化后台服务
- 承办量化投资大赛业务


## 使用指引

仿真交易包含：`界面-手动交易`和`接口-自动化交易`。

WEB界面用于手动交易和查看账户情况；接口用于策略交易，包含多种语言且用法相近

### 新建账户

![仿真账户](uploads/201903/attach_158df9c655e4237a.png)

**关于账户的重要说明**

- token是掘金服务的唯一身份识别，用于后台响应请求的身份验证
- accounID是仿真系统账户的编码，用于仿真服务识别仿真账户身份
- 在线仿真服务和掘金量化终端共用仿真账户
- 普通账户权限最多申请3个仿真账户
- 仿真交易账户类型分为股票和期货，新建时必须选定类型

### 手工交易

手工交易采用经典的行情+下单版的组合方式，提供股票和期货两种类型

![仿真交易](uploads/201903/attach_158e29f240e954b4.png)


> 交易界面采用WebSocket全双工通信的协议，可以同步监控当前账户的交易情况，比如监控策略交易情况


### 设置手续费和资金

- 账户的交易手续费和资金可以独立设置，股票精确到交易市场，默认为10%%
- 期货精确到品种，默认值同步交易所公布的最新合约数据
- 手续费修改仅对当前账户生效

![账户信息查看和设置](uploads/201903/attach_158e28cdabc2eb14.png)




### 下载仿真交易SDK

**python交易SDK下载**
- 准备环境：python3.6.0及以上版本
- python默认安装包存放在pypi仓库中，推荐用标准库安装方式安装`gmtrade`,方法为:
  在python.exe文件目录下用cmd命令窗口运行
  
```
    pip install gmtrade
```

**C++交易SDK下载：**

[点击下载：Windows系统 64&32交易SDK](https://www.myquant.cn/download/sdk?type=2&platform=windows&lang=cpp)

[点击下载：Linux系统 64&32交易SDK](https://www.myquant.cn/download/sdk?type=2&platform=linux&lang=cpp)

### 配置服务地址

在线仿真服务网关的公网地址

```
119.23.139.32:7101
```

如果部署了本地版仿真服务，该地址默认指向本机服务地址

配置服务地址
```
set_endpoint("119.23.139.32:7101")
```


### 配置身份信息

交易接口需要预先声明（token）和账户ID（accountID）。
登录官网`仿真账户交易`后获取，查看方式如下：

![账户信息查看和设置](uploads/201903/attach_20190416145213.png)

将获身份ID填入代码的配置接通仿真交易服务
```
# token身份认证，掘金登录后可在仿真交易官网获取
set_token("token")

account_id='accountID'

```

### 接口登录账户

通过login(account_id)登录账户，可同时登录多个账户，且仅登录后的账户可调用。

登录成功后，即可直接执行交易和查询，多账户场景下需指定账户

### 进行交易和查询

本SDK提供完整的交易业务接口，包括：

```python

# 按指定量委托,返回order结构
order_volume()

# 批量委托接口，返回多条order结构
order_batch() 

# 撤销委托
order_cancel()

# 撤销所有委托
order_cancel_all()
 
# 平当前所有可平持仓
order_close_all()

# 查询日内全部未结委托，返回order结构
get_unfinished_orders()
 
# 查询日内全部执行回报
get_execution_reports()
 
# 查询账户持仓，返回position结构
get_position()

# 查询账户资金，返回cash结构
get_cash()


```

接口的返回值通过标准的order、execrpt、cash、position等固定结构的对象返回，具体参照各语言接口字段对象


### 更及时获取交易信息
通过事件回调的方式获取交易信息，由服务器主推，速度更快、更及时

需要预先调用start()来启动消息推送，通过柜台主推信息到`指定函数`的方式进行,且要`保持启动的进程不退出`
通过stop() 停止事件接收

事件的类型有：
```
on_order_status - 委托状态更新事件
on_execution_report - 委托执行回报事件
on_account_status - 交易账户状态更新事件
on_trade_data_connected - 交易通道网络连接成功事件
on_trade_data_disconnected - 交易通道网络连接断开事件
on_error - 错误事件
```


事件回调的参数字段格式参照各语言接口字段对象

